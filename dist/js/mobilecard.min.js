!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(["jquery","formatter"],c):b[a]=c()}("mobilecard",this,function(a,b){var c=function(a,b){var c,d,e=function(a){return a.el.getAttribute("maxLength")},f=function(b,c){a(b.el).on("keyup",c)},g=function(a){a.el.setSelectionRange(a.lastSel,a.lastSel),a.el.focus()},h=function(b,c){a(b.el).css({color:c?"":"rgb(255, 0, 0)"})},i=function(a){a.formatter=new b(a.el,{pattern:"{{99}}/{{99}}"})},j=function(a,c){a.formatter?(a.formatter.resetPattern(c.format),a.el.setAttribute("maxLength",c.lengths.num)):a.formatter=new b(a.el,{pattern:c.format})},k=function(a,b){a.el.setAttribute("maxLength",b.lengths.cvc)},l=function(a,b){d.css({"-webkit-transform":"translate3d("+a+"px, 0px, 0px)"}),c[b]("entering-number")},m=function(){l(0,"addClass"),d.off("touchend")},n=function(a){l(o(),"removeClass"),d.on("touchend",function(){m(a),g(a)})},o=function(){var a=d[0],b=a.value,c=b.length,e=b.slice(0,c-4);return-p(a,e)},p=function(b,c){var d=window.getComputedStyle(b).cssText,e="position: absolute; top: -10000px; width: auto;",f=a("<div>").attr("style",d+e).text(c);f.appendTo(document.body);var g=f.width();return f.remove(),g},q=function(){c=a(".mobilecard"),d=c.find(".input-number > input")};return{displayFieldStatus:h,addKeyUpListener:f,addExpFormatter:i,getMaxLength:e,updateDisplay:l,updateNum:j,updateCvc:k,showNum:m,hideNum:n,focus:g,init:q}}(a,b),d=function(){var a="{{9999}} {{9999}} {{9999}} {{9999}}",b="{{9999}} {{999999}} {{99999}}",c=[{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:a,lengths:{num:19,cvc:3}},{type:"mastercard",pattern:/^5[1-5]/,format:a,lengths:{num:19,cvc:3}},{type:"amex",pattern:/^3[47]/,format:b,lengths:{num:17,cvc:4}},{type:"visa",pattern:/^4/,format:a,lengths:{num:19,cvc:3}},{type:"default",pattern:/\d*/,format:a,lengths:{num:19,cvc:3}}],d=function(a){for(var b=c.length,d=0;b>d;d++)if(c[d].pattern.test(a))return c[d]};return{matchPattern:d}}(),e=function(){var a=function(a){for(var c=1;c<arguments.length;c++)a=b(a,arguments[c]);return a},b=function(a,b){for(var c in b)"object"!=typeof b[c]||null===b[c]||b[c].tagName?a[c]=b[c]:(a[c]=a[c]||{},arguments.callee(a[c],b[c]));return a},c=function(a){var b=a.split("/");return{month:b[0],year:"20"+b[1]}};return{extend:a,extendObj:b,getExpParts:c}}(),f=function(a){var b=function(b){this.lastSel=0,this.validation={status:!0,onKey:!1},a.extend(this,b)};return b.prototype.validate=function(){return this.validation.status=this.test(this.el.value),this.validation.status},b.prototype.validateField=function(){return this.displayStatus(this,this.validate()),this.validation.status},b}(e),g=function(){var a=function(a){for(var b=a.replace(/[ -]+/g,""),c=b.length,d=0,e=0,f=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]];c--;)e+=f[d][parseInt(b.charAt(c),10)],d^=1;return e%10===0&&e>0},b=function(a){var b=new Date,c=b.getMonth()+1,d=b.getFullYear();return a.year>d+15||a.month>12?!1:a.year<d?!1:a.year>d?!0:a.month>=c},c=function(a,b){return a.length==b};return{card:a,exp:b,exactLength:c}}(),h=function(a,b,c,d,e){var f,g,h,i=function(b,c,d){var e=k.get(b,c);e.lastSel=c>0?0:e.el.value.length,a.focus(e),"function"==typeof d&&d(b)},j=function(b,c){var d=k[c],e=b.target.selectionEnd,f=b.which||b.keyCode;return d.before&&d.before(d.el.value),d.validateOnInput&&d.validation.onKey&&d.validateField(),!d.prev&&null!==d.prev||0!==e||0!==d.lastSel||8!=f?(d.next||null===d.next)&&e==a.getMaxLength(d)&&d.validateField()?i(d,1,d.next):(d.lastSel=d.el.value.length,m(),void 0):i(d,-1,d.prev)},k={order:[],add:function(b,d){var g=d.name,h=f[g],i=e.extend({},{el:h,index:this.order.length,displayStatus:a.displayFieldStatus},d);this[b]=new c(i),this.order.push(b),a.addKeyUpListener(this[b],function(a){j(a,b)})},get:function(a,b){return this[this.order[a.index+b]]}},l=function(){k.add("num",{name:"card_number",validateOnInput:!0,before:n,next:function(b){setTimeout(function(){a.hideNum(b)},60)},test:d.card}),k.add("exp",{name:"exp_date",validateOnInput:!0,prev:function(b){a.showNum(b)},next:null,test:function(a){var b=e.getExpParts(a);return d.exp(b)}}),k.add("cvc",{name:"cvc",prev:null,next:null,test:function(a){return d.exactLength(a,h.lengths.cvc)}}),k.add("zip",{name:"zip",prev:null,test:function(a){return d.exactLength(a,5)}})},m=function(){for(var a in k)if(k[a]instanceof c&&!k[a].validate())return g(!0);g(null)},n=function(c){var d=b.matchPattern(c);d!==h&&(h=d,a.updateNum(k.num,h),a.updateCvc(k.cvc,h))},o=function(){return{num:k.num.el.value,exp:e.getExpParts(k.exp.el.value),cvc:k.cvc.el.value,zip:k.zip.el.value}},p=function(b,c){f=b,g=c,a.init(),l(),a.addExpFormatter(k.exp),n("")};return{init:p,data:o}}(c,d,f,g,e);return h});