!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(["jquery","formatter"],c):b[a]=c()}("mobilecard",this,function(a,b){var c=function(a,b){var c,d,e=function(a){return a.el.getAttribute("maxLength")},f=function(b,c){a(b.el).on("keyup",c)},g=function(b,c){a(b.el).on("focus",c)},h=function(a){a.el.setSelectionRange(a.lastSel,a.lastSel),a.el.focus()},i=function(b,c){a(b.el).css({color:c?"":"rgb(255, 0, 0)"})},j=function(a,b){return console.log(b),b?a.el.removeAttribute("readonly"):a.el.setAttribute("readonly")},k=function(a){a.formatter=new b(a.el,{pattern:"{{99}}/{{99}}"})},l=function(a,c){a.formatter?a.formatter.resetPattern(c.format):a.formatter=new b(a.el,{pattern:c.format}),a.el.setAttribute("maxLength",c.lengths.num)},m=function(a,b){a.el.setAttribute("maxLength",b.lengths.cvc)},n=function(a,b){d.css({"-webkit-transform":"translate3d("+a+"px, 0px, 0px)"}),c[b]("entering-number")},o=function(){n(0,"addClass"),d.off("touchend")},p=function(a){n(q(),"removeClass"),d.on("touchend",function(){o(a),h(a)})},q=function(){var a=d[0],b=a.value,c=b.length,e=b.slice(0,c-4);return-r(a,e)},r=function(b,c){var d=window.getComputedStyle(b).cssText,e="position: absolute; top: -10000px; width: auto;",f=a("<div>").attr("style",d+e).text(c);f.appendTo(document.body);var g=f.width();return f.remove(),g},s=function(){c=a(".mobilecard"),d=c.find(".input-number > input")};return{displayFieldStatus:i,addFocusListener:g,addKeyUpListener:f,addExpFormatter:k,setReadOnly:j,getMaxLength:e,updateDisplay:n,updateNum:l,updateCvc:m,showNum:o,hideNum:p,focus:h,init:s}}(a,b),d=function(){var a="{{9999}} {{9999}} {{9999}} {{9999}}",b="{{9999}} {{999999}} {{99999}}",c=[{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:a,lengths:{num:19,cvc:3}},{type:"mastercard",pattern:/^5[1-5]/,format:a,lengths:{num:19,cvc:3}},{type:"amex",pattern:/^3[47]/,format:b,lengths:{num:17,cvc:4}},{type:"visa",pattern:/^4/,format:a,lengths:{num:19,cvc:3}},{type:"default",pattern:/\d*/,format:a,lengths:{num:19,cvc:3}}],d=function(a){for(var b=c.length,d=0;b>d;d++)if(c[d].pattern.test(a))return c[d]};return{matchPattern:d}}(),e=function(){var a=function(a){for(var c=1;c<arguments.length;c++)a=b(a,arguments[c]);return a},b=function(a,b){for(var c in b)"object"!=typeof b[c]||null===b[c]||b[c].tagName?a[c]=b[c]:(a[c]=a[c]||{},arguments.callee(a[c],b[c]));return a},c=function(a){var b=a.split("/");return{month:b[0],year:"20"+b[1]}};return{extend:a,extendObj:b,getExpParts:c}}(),f=function(a){var b=function(b){this.lastSel=0,this.validation={status:!0,onKey:!1},a.extend(this,b)};return b.prototype.validate=function(){return this.validation.status=this.test(this.el.value),this.validation.status},b.prototype.validateField=function(){return this.displayStatus(this,this.validate()),this.validation.status},b}(e),g=function(){var a=function(a){for(var b=a.replace(/[ -]+/g,""),c=b.length,d=0,e=0,f=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]];c--;)e+=f[d][parseInt(b.charAt(c),10)],d^=1;return e%10===0&&e>0},b=function(a){var b=new Date,c=b.getMonth()+1,d=b.getFullYear();return a.year>d+15||a.month>12?!1:a.year<d?!1:a.year>d?!0:a.month>=c},c=function(a,b){return a.length==b};return{card:a,exp:b,exactLength:c}}(),h=function(a,b,c,d,e){var f,g,h,i=function(a,b){var c=l[b];c.focus&&c.focus(c)},j=function(b,c,d){var e=l.get(b,c);e.lastSel=c>0?0:e.el.value.length,a.focus(e),"function"==typeof d&&d(b)},k=function(b,c){var d=l[c],e=b.target.selectionEnd,f=b.which||b.keyCode;return d.before&&d.before(d),d.validateOnInput&&d.validation.onKey&&d.validateField(),!d.prev&&null!==d.prev||0!==e||0!==d.lastSel||8!=f?(d.next||null===d.next)&&e==a.getMaxLength(d)&&d.validateField()?j(d,1,d.next):(d.lastSel=d.el.value.length,d.after&&d.after(d),o(),void 0):j(d,-1,d.prev)},l={order:[],add:function(b,d){var g=d.name,h=f[g],j=e.extend({},{el:h,index:this.order.length,displayStatus:a.displayFieldStatus},d);this[b]=new c(j),this.order.push(b),a.addKeyUpListener(this[b],function(a){k(a,b)}),a.addFocusListener(this[b],function(a){i(a,b)})},get:function(a,b){return this[this.order[a.index+b]]}},m=function(){l.add("num",{name:"card_number",validateOnInput:!0,before:function(b){q(b.el.value);var c=a.getMaxLength(b)==b.el.value.length;p(b.validate()&&c)},next:function(b){setTimeout(function(){a.hideNum(b)},60)},after:n,focus:a.showNum,test:d.card}),l.add("exp",{name:"exp_date",validateOnInput:!0,prev:function(b){a.showNum(b)},next:null,focus:function(b){setTimeout(function(){a.hideNum(b)},60)},after:n,test:function(a){var b=e.getExpParts(a);return d.exp(b)}}),l.add("cvc",{name:"cvc",prev:null,next:null,test:function(a){return d.exactLength(a,h.lengths.cvc)}}),l.add("zip",{name:"zip",prev:null,test:function(a){return d.exactLength(a,5)}})},n=function(b){0===b.lastSel&&(b.validation.onKey=!1,a.displayFieldStatus(b,!0))},o=function(){for(var a in l)if(l[a]instanceof c&&!l[a].validate())return g(!0);g(null)},p=function(b){for(var d in l)l[d]instanceof c&&"num"!==d&&a.setReadOnly(l[d],b)},q=function(c){var d=b.matchPattern(c);d!==h&&(h=d,a.updateNum(l.num,h),a.updateCvc(l.cvc,h))},r=function(){return{num:l.num.el.value,exp:e.getExpParts(l.exp.el.value),cvc:l.cvc.el.value,zip:l.zip.el.value}},s=function(b,c){f=b,g=c,a.init(),m(),a.addExpFormatter(l.exp),q(""),p(!1)};return{init:s,data:r}}(c,d,f,g,e);return h});